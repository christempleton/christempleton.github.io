<?php function removeXMLFiles($src){if($src==""){return;}$dir=opendir($src);while(false!==($file=readdir($dir))){if(($file!='.')&&($file!='..')&&$file!=""){$full=$src.'/'.$file;$intFileTime=filemtime($full);if(substr($file,-4)==".xml"){if(!$intFileTime or(time()- $intFileTime<$intCacheSeonds)){unlink($full);}}else{unlink($full);}}}closedir($dir);}$strEWApiURL="https://rssapi.everweb-api.com/getFeed.php";$RSSFeedUrl=$_GET['Rss_url'];$maxNr=$_GET['num'];$hash=$_GET['code'];if($RSSFeedUrl==""||$maxNr==""||$hash==""){exit;}$fileName=$hash.".xml";$strCacheDirName="rss_cache_files";$boolNewContent=FALSE;$intCacheSeonds=10000;$data=array('Rss_url'=>$RSSFeedUrl,'code'=>$hash,'num'=>$maxNr,);$params='';foreach($data as $key=>$value)$params.=$key.'='.$value.'&';$params=trim($params,'&');if(!file_exists($strCacheDirName)){if(mkdir($strCacheDirName,0700)){}else{}}else{$intFileTime=filemtime($strCacheDirName);if((time()- $intFileTime>86400)){if(removeXMLFiles($strCacheDirName)){}else{}}}$fileName=$strCacheDirName."/".$fileName;if(file_exists($fileName)){$intFileTime=filemtime($fileName);if(!$intFileTime or(time()- $intFileTime<$intCacheSeonds)){$myfile=@fopen($fileName,"r");if($myfile){$domSrc=fread($myfile,filesize($fileName));}}else{}}if($domSrc==""){$ch=curl_init();curl_setopt($ch,CURLOPT_URL,$strEWApiURL.'?'.$params);curl_setopt($ch,CURLOPT_FOLLOWLOCATION,true);curl_setopt($ch,CURLOPT_MAXREDIRS,3);curl_setopt($ch,CURLOPT_RETURNTRANSFER,1);$domSrc=curl_exec($ch);curl_close($ch);$boolNewContent=TRUE;}if($domSrc==""){echo "";}elseif($boolNewContent){$myfile=fopen($fileName,"w");if($myfile){fwrite($myfile,$domSrc);fclose($myfile);if(!chmod($fileName,0640)){}}else{}}header("content-type: application/json; charset=utf-8");header("Access-Control-Allow-Origin: *");echo $domSrc;?>